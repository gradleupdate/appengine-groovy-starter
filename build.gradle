apply plugin: 'war'
apply plugin: 'appengine'
apply plugin: 'idea'

description='Blank template of application on the Google App Engine'

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.google.appengine:gradle-appengine-plugin:1.8.6'
    }
}

repositories {
    mavenCentral()
}

dependencies {
    def gaeVersion = '1.8.8'

    compile "com.google.appengine:appengine-api-1.0-sdk:$gaeVersion"
    compile "com.google.appengine:appengine-api-labs:$gaeVersion"
    compile 'javax.servlet:servlet-api:2.5'

    testCompile "com.google.appengine:appengine-api-stubs:$gaeVersion"
    testCompile "com.google.appengine:appengine-testing:$gaeVersion"
}

appengine {
    httpPort = 8888
    stopPort = 8889
    stopKey = project.name
    disableUpdateCheck = true
    warDir = file('src/main/webapp')
    jvmFlags = ['-Xdebug', '-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8890']

    appcfg {
        oauth2 = true
    }
}

sourceSets {
    main.output.classesDir = 'src/main/webapp/WEB-INF/classes'
}

task copyWebInfLib(type: Sync) {
    from configurations.runtime
    into 'src/main/webapp/WEB-INF/lib'
}
tasks.appengineRun.dependsOn(tasks.copyWebInfLib)

idea {
    module {
        inheritOutputDirs = false
        outputDir = sourceSets.main.output.classesDir
        testOutputDir = sourceSets.test.output.classesDir
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '1.9'
}
